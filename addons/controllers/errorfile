Running Suite: Addon Controller Suite
=====================================
Random Seed: [1m1652832712[0m
Will run [1m31[0m of [1m31[0m specs

[1mSTEP[0m: bootstrapping test environment
1.65283275751108e+09	INFO	external CRD paths	{"crdPaths": ["/Users/malavi/pkg/mod/sigs.k8s.io/cluster-api@v1.1.3/config/crd/bases", "/Users/malavi/pkg/mod/sigs.k8s.io/cluster-api@v1.1.3/controlplane/kubeadm/config/crd/bases", "/Users/malavi/pkg/mod/github.com/vmware-tanzu/carvel-kapp-controller@v0.25.0/config/crds.yml", "/Users/malavi/pkg/mod/sigs.k8s.io/cluster-api-provider-vsphere@v1.1.0/config/default/crd/bases", "/Users/malavi/pkg/mod/sigs.k8s.io/cluster-api-provider-vsphere@v1.1.0/config/supervisor/crd"]}
1.652832757511445e+09	DEBUG	controller-runtime.test-env	starting control plane
1.652832758076142e+09	ERROR	controller-runtime.test-env	unable to start the controlplane	{"tries": 0, "error": "timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)"}
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).startControlPlane
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:330
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).Start
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:260
github.com/vmware-tanzu/tanzu-framework/addons/controllers.glob..func10
	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:132
reflect.Value.call
	/usr/local/go/src/reflect/value.go:556
reflect.Value.Call
	/usr/local/go/src/reflect/value.go:339
github.com/onsi/ginkgo/internal/leafnodes.newRunner.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:49
github.com/onsi/ginkgo/internal/leafnodes.(*runner).runAsync.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:86
1.652832758115309e+09	ERROR	controller-runtime.test-env	unable to start the controlplane	{"tries": 1, "error": "timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)"}
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).startControlPlane
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:330
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).Start
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:260
github.com/vmware-tanzu/tanzu-framework/addons/controllers.glob..func10
	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:132
reflect.Value.call
	/usr/local/go/src/reflect/value.go:556
reflect.Value.Call
	/usr/local/go/src/reflect/value.go:339
github.com/onsi/ginkgo/internal/leafnodes.newRunner.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:49
github.com/onsi/ginkgo/internal/leafnodes.(*runner).runAsync.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:86
1.6528327581517398e+09	ERROR	controller-runtime.test-env	unable to start the controlplane	{"tries": 2, "error": "timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)"}
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).startControlPlane
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:330
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).Start
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:260
github.com/vmware-tanzu/tanzu-framework/addons/controllers.glob..func10
	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:132
reflect.Value.call
	/usr/local/go/src/reflect/value.go:556
reflect.Value.Call
	/usr/local/go/src/reflect/value.go:339
github.com/onsi/ginkgo/internal/leafnodes.newRunner.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:49
github.com/onsi/ginkgo/internal/leafnodes.(*runner).runAsync.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:86
1.652832758187721e+09	ERROR	controller-runtime.test-env	unable to start the controlplane	{"tries": 3, "error": "timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)"}
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).startControlPlane
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:330
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).Start
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:260
github.com/vmware-tanzu/tanzu-framework/addons/controllers.glob..func10
	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:132
reflect.Value.call
	/usr/local/go/src/reflect/value.go:556
reflect.Value.Call
	/usr/local/go/src/reflect/value.go:339
github.com/onsi/ginkgo/internal/leafnodes.newRunner.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:49
github.com/onsi/ginkgo/internal/leafnodes.(*runner).runAsync.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:86
1.652832758226062e+09	ERROR	controller-runtime.test-env	unable to start the controlplane	{"tries": 4, "error": "timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)"}
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).startControlPlane
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:330
sigs.k8s.io/controller-runtime/pkg/envtest.(*Environment).Start
	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/envtest/server.go:260
github.com/vmware-tanzu/tanzu-framework/addons/controllers.glob..func10
	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:132
reflect.Value.call
	/usr/local/go/src/reflect/value.go:556
reflect.Value.Call
	/usr/local/go/src/reflect/value.go:339
github.com/onsi/ginkgo/internal/leafnodes.newRunner.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:49
github.com/onsi/ginkgo/internal/leafnodes.(*runner).runAsync.func1
	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:86
[91m[1mFailure [0.816 seconds][0m
[91m[1m[BeforeSuite] BeforeSuite [0m
[37m/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:105[0m

  [91mUnexpected error:
      <*fmt.wrapError | 0xc000595160>: {
          msg: "unable to start control plane itself: failed to start the controlplane. retried 5 times: timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)",
          err: <*fmt.wrapError | 0xc000595120>{
              msg: "failed to start the controlplane. retried 5 times: timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)",
              err: <*errors.errorString | 0xc000708a80>{
                  s: "timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)",
              },
          },
      }
      unable to start control plane itself: failed to start the controlplane. retried 5 times: timeout waiting for process etcd to start successfully (it may have failed to start, or stopped unexpectedly before becoming ready)
  occurred[0m

  /Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:133
[90m------------------------------[0m
[91m[1mPanic [0.001 seconds][0m
[91m[1m[AfterSuite] AfterSuite [0m
[37m/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:394[0m

  [91m[1mTest Panicked[0m
  [91mruntime error: invalid memory address or nil pointer dereference[0m
  /usr/local/go/src/runtime/panic.go:221

  [91mFull Stack Trace[0m
  k8s.io/client-go/discovery.NewDiscoveryClientForConfig(0x28)
  	/Users/malavi/pkg/mod/k8s.io/client-go@v0.23.4/discovery/discovery_client.go:489 +0x29
  sigs.k8s.io/controller-runtime/pkg/client/apiutil.NewDiscoveryRESTMapper(0x2813e6e)
  	/Users/malavi/pkg/mod/sigs.k8s.io/controller-runtime@v0.11.1/pkg/client/apiutil/apimachinery.go:64 +0x19
  github.com/vmware-tanzu/tanzu-framework/addons/test/testutil.parseObjects(0x0, 0x10aad85)
  	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/test/testutil/test_helpers.go:83 +0xee
  github.com/vmware-tanzu/tanzu-framework/addons/test/testutil.DeleteResources(0xc00003db40, 0x2a14b80, {0x0, 0x0}, 0x1)
  	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/test/testutil/test_helpers.go:93 +0xa5
  github.com/vmware-tanzu/tanzu-framework/addons/controllers.glob..func11()
  	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:397 +0x8f
  github.com/onsi/ginkgo/internal/leafnodes.(*runner).runSync(0x223b23a)
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:113 +0xba
  github.com/onsi/ginkgo/internal/leafnodes.(*runner).run(0xc0000e19a0)
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/runner.go:64 +0x125
  github.com/onsi/ginkgo/internal/leafnodes.(*simpleSuiteNode).Run(0xc00031a780, 0x1007fe5, 0xc0005a03c0, {0x100ebf4, 0xc0001dd2d0})
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/leafnodes/suite_nodes.go:25 +0x86
  github.com/onsi/ginkgo/internal/specrunner.(*SpecRunner).runAfterSuite(0xc0005aa840)
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/specrunner/spec_runner.go:138 +0xc7
  github.com/onsi/ginkgo/internal/specrunner.(*SpecRunner).Run(0xc0005aa840)
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/specrunner/spec_runner.go:71 +0xdd
  github.com/onsi/ginkgo/internal/suite.(*Suite).Run(0xc0002d1260, {0x74d31d8, 0xc0003b3ba0}, {0x27cd2f1, 0x16}, {0xc00015eae0, 0x2, 0x2}, {0x2a45078, 0xc00003d080}, ...)
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/internal/suite/suite.go:79 +0x4d2
  github.com/onsi/ginkgo.runSpecsWithCustomReporters({0x29f4de0, 0xc0003b3ba0}, {0x27cd2f1, 0x16}, {0xc00015eac0, 0x2, 0x27d0f16})
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/ginkgo_dsl.go:245 +0x185
  github.com/onsi/ginkgo.RunSpecsWithDefaultAndCustomReporters({0x29f4de0, 0xc0003b3ba0}, {0x27cd2f1, 0x16}, {0xc0004b3750, 0x1, 0x1})
  	/Users/malavi/pkg/mod/github.com/onsi/ginkgo@v1.16.5/ginkgo_dsl.go:228 +0x1be
  github.com/vmware-tanzu/tanzu-framework/addons/controllers.TestAddonController(0x0)
  	/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:100 +0x6e
  testing.tRunner(0xc0003b3ba0, 0x2890a10)
  	/usr/local/go/src/testing/testing.go:1259 +0x102
  created by testing.(*T).Run
  	/usr/local/go/src/testing/testing.go:1306 +0x35a
[90m------------------------------[0m


[1m[91mRan 31 of 0 Specs in 0.818 seconds[0m
[1m[91mFAIL![0m -- [32m[1m0 Passed[0m | [91m[1m31 Failed[0m | [33m[1m0 Pending[0m | [36m[1m0 Skipped[0m
--- FAIL: TestAddonController (0.84s)

[38;5;228mYou're using deprecated Ginkgo functionality:[0m
[38;5;228m=============================================[0m
[1m[38;5;10mGinkgo 2.0[0m is under active development and will introduce several new features, improvements, and a small handful of breaking changes.
A release candidate for 2.0 is now available and 2.0 should GA in Fall 2021.  [1mPlease give the RC a try and send us feedback![0m
  - To learn more, view the migration guide at [38;5;14m[4mhttps://github.com/onsi/ginkgo/blob/ver2/docs/MIGRATING_TO_V2.md[0m
  - For instructions on using the Release Candidate visit [38;5;14m[4mhttps://github.com/onsi/ginkgo/blob/ver2/docs/MIGRATING_TO_V2.md#using-the-beta[0m
  - To comment, chime in at [38;5;14m[4mhttps://github.com/onsi/ginkgo/issues/711[0m

  [38;5;11mYou are using a custom reporter.  Support for custom reporters will likely be removed in V2.  Most users were using them to generate junit or teamcity reports and this functionality will be merged into the core reporter.  In addition, Ginkgo 2.0 will support emitting a JSON-formatted report that users can then manipulate to generate custom reports.

  [38;5;9m[1mIf this change will be impactful to you please leave a comment on [38;5;14m[4mhttps://github.com/onsi/ginkgo/issues/711[0m[0m
  [1mLearn more at:[0m [38;5;14m[4mhttps://github.com/onsi/ginkgo/blob/ver2/docs/MIGRATING_TO_V2.md#removed-custom-reporters[0m
  [38;5;11mYou are passing a Done channel to a test node to test asynchronous behavior.  This is deprecated in Ginkgo V2.  Your test will run synchronously and the timeout will be ignored.[0m
  [1mLearn more at:[0m [38;5;14m[4mhttps://github.com/onsi/ginkgo/blob/ver2/docs/MIGRATING_TO_V2.md#removed-async-testing[0m
    [38;5;243m/Users/malavi/src/github.com/vmware-tanzu/tanzu-framework/addons/controllers/suite_test.go:105[0m

[38;5;243mTo silence deprecations that can be silenced set the following environment variable:[0m
  [38;5;243mACK_GINKGO_DEPRECATIONS=1.16.5[0m

FAIL

Ginkgo ran 1 suite in 46.03636058s
Test Suite Failed
